oc new-project vault-argo-demo
 
vault auth enable kubernetes
 
vault write auth/kubernetes/config token_reviewer_jwt="$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443" kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
issuer=issuer=https://kubernetes.default.svc
(to check your issuer: kubectl proxy & curl --silent http://127.0.0.1:8001/.well-known/openid-configuration | jq -r .issuer)

vault kv put secret/vault-demo-secret1 username="phil" password="notverysecure"

vault policy write pmodemo - <<EOF path "secret/data/vault-demo-secret1" { capabilities = ["read"] } EOF

vault write auth/kubernetes/role/pmodemo bound_service_account_names=vault bound_service_account_namespaces=vault-demo policies=pmodemo ttl=60m
check token:
OCP_TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
check vault:
curl -k --request POST --data '{"jwt": "'"$OCP_TOKEN"'", "role": ""}' http://172.30.46.242:8200/v1/auth/kubernetes/login

vault audit enable file file_path=/var/log/vault_audit.log

set the varibale to the Vault svc:port 

apiVersion: kubernetes-client.io/v1
kind: ExternalSecret
metadata:
  name: exsecretsdemo
  namespace: vault-demo
spec:
  backendType: vault
  data:
    - key: secret/data/vault-demo-secret1
      name: password
      property: password
  vaultMountPoint: kubernetes
  vaultRole: exsecretsdemo
